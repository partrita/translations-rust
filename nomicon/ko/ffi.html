<!DOCTYPE HTML>
<html lang="ko" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>FFI - The Rustonomicon</title>


        <!-- Custom HTML head -->

        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L455DH98TK"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-L455DH98TK');
        </script>
        
        
        <script>
            (function () {
                // See these pages for details:
                // https://developers.google.com/search/docs/crawling-indexing/consolidate-duplicate-urls
                // https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics
        
                function gen_canonical_href(lang) {
        
                    let base = "https://rust-lang-translations.org/nomicon";
        
                    let canonical_href;
                    if (lang == "en") {
                        canonical_href = `${base}/ffi.md`;
                    } else {
                        canonical_href = `${base}/${lang}/ffi.md`;
                    }
                    canonical_href = canonical_href.slice(0, -"md".length) + "html";
                    if (canonical_href.endsWith("/index.html")) {
                        canonical_href = canonical_href.slice(0, -"index.html".length);
                    }
                    return canonical_href;
                }
        
                const canonical_href = gen_canonical_href("ko");

                let link = document.createElement("link");
                link.rel = "canonical";
                link.href = canonical_href;
                document.head.appendChild(link);
        
        
                const langs = ["en"  , "ko" ];
        
                for (const lang of langs) {
                    const canonical_href = gen_canonical_href(lang);
        
                    let link = document.createElement("link");
                    link.rel = "alternate";
                    link.hreflang = lang;
                    link.href = canonical_href;
                    document.head.appendChild(link);
                }
            })()
        </script>
        

        <meta name="description" content="The Dark Arts of Advanced and Unsafe Rust Programming">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/nomicon-77782d80.css">
        <link rel="stylesheet" href="theme/language-picker-00e4db94.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-3866c42d.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-1af1b443.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rustonomicon</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang-translations/project" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="외부-함수-인터페이스-foreign-function-interface-ffi"><a class="header" href="#외부-함수-인터페이스-foreign-function-interface-ffi">외부 함수 인터페이스 (Foreign Function Interface, FFI)</a></h1>
<h2 id="소개"><a class="header" href="#소개">소개</a></h2>
<p>이 가이드는 외부 코드용 바인딩 작성을 소개하기 위해 <a href="https://github.com/google/snappy">snappy</a> 압축/해제 라이브러리를 사용할 것입니다. 러스트는 현재 C++ 라이브러리를 직접 호출할 수 없지만, snappy는 (<a href="https://github.com/google/snappy/blob/master/snappy-c.h"><code>snappy-c.h</code></a>에 문서화된) C 인터페이스를 포함하고 있습니다.</p>
<h2 id="libc에-대한-참고-사항"><a class="header" href="#libc에-대한-참고-사항">libc에 대한 참고 사항</a></h2>
<p>Many of these examples use <a href="https://crates.io/crates/libc">the <code>libc</code> crate</a>, which provides various type definitions for C types, among other things. If you’re trying out these examples yourself, you’ll need to add <code>libc</code> to your <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[dependencies]
libc = "0.2.0"
</code></pre>
<h2 id="prepare-the-build-script"><a class="header" href="#prepare-the-build-script">Prepare the build script</a></h2>
<p>Because <a href="https://github.com/google/snappy">snappy</a> is a static library by default, so there is no stdc++ linked in the output artifact. In order to use this foreign library in Rust, we have to manually specify that we want to link stdc++ std to our project. The easiest way to do this is by setting up a build script.</p>
<p>First edit <code>Cargo.toml</code>, inside <code>package</code> add <code>build = "build.rs"</code>:</p>
<pre><code class="language-toml">[package]
...
build = "build.rs"
</code></pre>
<p>Then create a new file at the root of your workspace, named <code>build.rs</code>:</p>
<pre class="playground"><code class="language-rust edition2024">// build.rs
fn main() {
    println!("cargo:rustc-link-lib=dylib=stdc++"); // This line may be unnecessary for some environments.
    println!("cargo:rustc-link-search=&lt;YOUR SNAPPY LIBRARY PATH&gt;");
}</code></pre>
<p>For more information, please read <a href="https://doc.rust-lang.org/cargo/reference/build-scripts.html">The Cargo Book - build script</a>.</p>
<h2 id="외부-함수-호출하기"><a class="header" href="#외부-함수-호출하기">외부 함수 호출하기</a></h2>
<p>다음은 snappy가 설치되어 있다면 컴파일될, 외부 함수를 호출하는 최소한의 예제입니다:</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore">use libc::size_t;

#[link(name = "snappy")]
unsafe extern "C" {
    fn snappy_max_compressed_length(source_length: size_t) -&gt; size_t;
}

fn main() {
    let x = unsafe { snappy_max_compressed_length(100) };
    println!("100바이트 버퍼의 최대 압축 길이: {}", x);
}</code></pre>
<p>The <code>extern</code> block is a list of function signatures in a foreign library, in this case with the platform’s C ABI. The <code>#[link(...)]</code> attribute is used to instruct the linker to link against the snappy library so the symbols can be resolved.</p>
<p>외부 함수들은 비안전(unsafe)한 것으로 간주되므로, 그 호출은 그 안에 포함된 모든 것이 정말로 안전하다는 컴파일러에 대한 약속으로서 <code>unsafe {}</code> 로 감싸야 합니다. C 라이브러리들은 종종 스레드 안전하지 않은 인터페이스를 노출하며, 포인터 인자를 받는 거의 모든 함수는 포인터가 매달려 있을(dangling) 수 있으므로 모든 가능한 입력에 대해 유효하지 않습니다. 또한 원시 포인터는 러스트의 안전한 메모리 모델을 벗어납니다.</p>
<p>외부 함수에 대한 인자 타입을 선언할 때, 러스트 컴파일러는 선언이 올바른지 확인할 수 없습니다. 따라서 이를 올바르게 지정하는 것은 런타임에 바인딩이 올바르게 유지되도록 하는 일의 일부입니다.</p>
<p><code>extern</code> 블록을 확장하여 전체 snappy API를 다룰 수 있습니다:</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore">use libc::{c_int, size_t};

#[link(name = "snappy")]
unsafe extern "C" {
    fn snappy_compress(input: *const u8,
                       input_length: size_t,
                       compressed: *mut u8,
                       compressed_length: *mut size_t) -&gt; c_int;
    fn snappy_uncompress(compressed: *const u8,
                         compressed_length: size_t,
                         uncompressed: *mut u8,
                         uncompressed_length: *mut size_t) -&gt; c_int;
    fn snappy_max_compressed_length(source_length: size_t) -&gt; size_t;
    fn snappy_uncompressed_length(compressed: *const u8,
                                  compressed_length: size_t,
                                  result: *mut size_t) -&gt; c_int;
    fn snappy_validate_compressed_buffer(compressed: *const u8,
                                         compressed_length: size_t) -&gt; c_int;
}
<span class="boring">fn main() {}</span></code></pre>
<h2 id="안전한-인터페이스-만들기"><a class="header" href="#안전한-인터페이스-만들기">안전한 인터페이스 만들기</a></h2>
<p>메모리 안전성을 제공하고 벡터와 같은 고수준 개념을 활용하기 위해 원시 C API를 래핑할 필요가 있습니다. 라이브러리는 안전한 고수준 인터페이스만을 노출하고 비안전한 내부 세부 사항은 숨기기로 선택할 수 있습니다.</p>
<p>Wrapping the functions which expect buffers involves using the <code>slice::raw</code> module to manipulate Rust’s vectors as pointers to memory. Rust’s vectors are guaranteed to be a contiguous block of memory. The length is the number of elements currently contained, and the capacity is the total size in elements of the allocated memory. The length is less than or equal to the capacity.</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore"><span class="boring">use libc::{c_int, size_t};
</span><span class="boring">unsafe fn snappy_validate_compressed_buffer(_: *const u8, _: size_t) -&gt; c_int { 0 }
</span><span class="boring">fn main() {}
</span>pub fn validate_compressed_buffer(src: &amp;[u8]) -&gt; bool {
    unsafe {
        snappy_validate_compressed_buffer(src.as_ptr(), src.len() as size_t) == 0
    }
}</code></pre>
<p>위의 <code>validate_compressed_buffer</code> 래퍼는 <code>unsafe</code> 블록을 사용하지만, 함수 시그니처에서 <code>unsafe</code> 를 뺌으로써 모든 입력에 대해 호출이 안전하다는 것을 보장합니다.</p>
<p><code>snappy_compress</code> 와 <code>snappy_uncompress</code> 함수는 출력물을 담을 버퍼도 할당해야 하므로 더 복잡합니다.</p>
<p><code>snappy_max_compressed_length</code> 함수는 압축된 출력을 담기에 충분한 최대 용량을 가진 벡터를 할당하는 데 사용될 수 있습니다. 그런 다음 이 벡터는 <code>snappy_compress</code> 함수에 출력 매개변수로 전달될 수 있습니다. 또한 압축 후 실제 길이를 가져와서 벡터의 길이를 설정하기 위한 출력 매개변수도 전달됩니다.</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore"><span class="boring">use libc::{size_t, c_int};
</span><span class="boring">unsafe fn snappy_compress(a: *const u8, b: size_t, c: *mut u8,
</span><span class="boring">                          d: *mut size_t) -&gt; c_int { 0 }
</span><span class="boring">unsafe fn snappy_max_compressed_length(a: size_t) -&gt; size_t { a }
</span><span class="boring">fn main() {}
</span>pub fn compress(src: &amp;[u8]) -&gt; Vec&lt;u8&gt; {
    unsafe {
        let srclen = src.len() as size_t;
        let psrc = src.as_ptr();

        let mut dstlen = snappy_max_compressed_length(srclen);
        let mut dst = Vec::with_capacity(dstlen as usize);
        let pdst = dst.as_mut_ptr();

        snappy_compress(psrc, srclen, pdst, &amp;mut dstlen);
        dst.set_len(dstlen as usize);
        dst
    }
}</code></pre>
<p>압축 해제도 비슷합니다. snappy는 압축 형식의 일부로 압축되지 않은 크기를 저장하며, <code>snappy_uncompressed_length</code> 는 필요한 정확한 버퍼 크기를 가져올 것이기 때문입니다.</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore"><span class="boring">use libc::{size_t, c_int};
</span><span class="boring">unsafe fn snappy_uncompress(compressed: *const u8,
</span><span class="boring">                            compressed_length: size_t,
</span><span class="boring">                            uncompressed: *mut u8,
</span><span class="boring">                            uncompressed_length: *mut size_t) -&gt; c_int { 0 }
</span><span class="boring">unsafe fn snappy_uncompressed_length(compressed: *const u8,
</span><span class="boring">                                     compressed_length: size_t,
</span><span class="boring">                                     result: *mut size_t) -&gt; c_int { 0 }
</span><span class="boring">fn main() {}
</span>pub fn uncompress(src: &amp;[u8]) -&gt; Option&lt;Vec&lt;u8&gt;&gt; {
    unsafe {
        let srclen = src.len() as size_t;
        let psrc = src.as_ptr();

        let mut dstlen: size_t = 0;
        snappy_uncompressed_length(psrc, srclen, &amp;mut dstlen);

        let mut dst = Vec::with_capacity(dstlen as usize);
        let pdst = dst.as_mut_ptr();

        if snappy_uncompress(psrc, srclen, pdst, &amp;mut dstlen) == 0 {
            dst.set_len(dstlen as usize);
            Some(dst)
        } else {
            None // SNAPPY_INVALID_INPUT
        }
    }
}</code></pre>
<p>그 다음, 이것들을 어떻게 사용하는지 보여주기 위한 테스트를 추가할 수 있습니다.</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore"><span class="boring">use libc::{c_int, size_t};
</span><span class="boring">unsafe fn snappy_compress(input: *const u8,
</span><span class="boring">                          input_length: size_t,
</span><span class="boring">                          compressed: *mut u8,
</span><span class="boring">                          compressed_length: *mut size_t)
</span><span class="boring">                          -&gt; c_int { 0 }
</span><span class="boring">unsafe fn snappy_uncompress(compressed: *const u8,
</span><span class="boring">                            compressed_length: size_t,
</span><span class="boring">                            uncompressed: *mut u8,
</span><span class="boring">                            uncompressed_length: *mut size_t)
</span><span class="boring">                            -&gt; c_int { 0 }
</span><span class="boring">unsafe fn snappy_max_compressed_length(source_length: size_t) -&gt; size_t { 0 }
</span><span class="boring">unsafe fn snappy_uncompressed_length(compressed: *const u8,
</span><span class="boring">                                     compressed_length: size_t,
</span><span class="boring">                                     result: *mut size_t)
</span><span class="boring">                                     -&gt; c_int { 0 }
</span><span class="boring">unsafe fn snappy_validate_compressed_buffer(compressed: *const u8,
</span><span class="boring">                                            compressed_length: size_t)
</span><span class="boring">                                            -&gt; c_int { 0 }
</span><span class="boring">fn main() { }
</span><span class="boring">
</span>#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn valid() {
        let d = vec![0xde, 0xad, 0xd0, 0x0d];
        let c: &amp;[u8] = &amp;compress(&amp;d);
        assert!(validate_compressed_buffer(c));
        assert!(uncompress(c) == Some(d));
    }

    #[test]
    fn invalid() {
        let d = vec![0, 0, 0, 0];
        assert!(!validate_compressed_buffer(&amp;d));
        assert!(uncompress(&amp;d).is_none());
    }

    #[test]
    fn empty() {
        let d = vec![];
        assert!(!validate_compressed_buffer(&amp;d));
        assert!(uncompress(&amp;d).is_none());
        let c = compress(&amp;d);
        assert!(validate_compressed_buffer(&amp;c));
        assert!(uncompress(&amp;c) == Some(d));
    }
}</code></pre>
<h2 id="소멸자"><a class="header" href="#소멸자">소멸자</a></h2>
<p>Foreign libraries often hand off ownership of resources to the calling code. When this occurs, we must use Rust’s destructors to provide safety and guarantee the release of these resources (especially in the case of a panic).</p>
<p>For more information about destructors, see the <a href="../std/ops/trait.Drop.html">Drop trait</a>.</p>
<h2 id="c에서-러스트-코드-호출하기"><a class="header" href="#c에서-러스트-코드-호출하기">C에서 러스트 코드 호출하기</a></h2>
<p>You may wish to compile Rust code in a way that can be called from C. This is fairly easy, but requires a few things.</p>
<h3 id="러스트-측"><a class="header" href="#러스트-측">러스트 측</a></h3>
<p>먼저, <code>rust_from_c</code> 라는 이름의 라이브러리 크레이트가 있다고 가정합니다. <code>lib.rs</code> 에는 다음과 같은 러스트 코드가 있어야 합니다:</p>
<pre class="playground"><code class="language-rust edition2024">#[unsafe(no_mangle)]
pub extern "C" fn hello_from_rust() {
    println!("러스트에서 인사드립니다!");
}
<span class="boring">fn main() {}</span></code></pre>
<p>“<a href="ffi.html#foreign-calling-conventions">외부 호출 규약(Foreign Calling Conventions)</a>” 섹션에서 논의할 것과 같습니다. <code>no_mangle</code> 속성은 러스트의 이름 맹글링(name mangling)을 꺼서, 링크할 수 있는 잘 정의된 심볼을 갖게 합니다.“<a href="ffi.html#foreign-calling-conventions">외부 호출 규약(Foreign Calling Conventions)</a>” 섹션에서 논의할 것과 같습니다. <code>no_mangle</code> 속성은 러스트의 이름 맹글링(name mangling)을 꺼서, 링크할 수 있는 잘 정의된 심볼을 갖게 합니다.</p>
<p>그 다음, C에서 호출할 수 있는 공유 라이브러리로 러스트 코드를 컴파일하려면 <code>Cargo.toml</code> 에 다음을 추가하십시오:</p>
<pre><code class="language-toml">[lib]
crate-type = ["cdylib"]
</code></pre>
<p>(NOTE: We could also use the <code>staticlib</code> crate type but it also requires tweaking some linking flags.)</p>
<p><code>cargo build</code> 를 실행하면 러스트 측 준비는 끝납니다.</p>
<h3 id="c-측"><a class="header" href="#c-측">C 측</a></h3>
<p><code>hello_from_rust</code> 함수를 호출할 C 파일을 만들고 <code>gcc</code> 로 컴파일할 것입니다.</p>
<p>C 파일은 다음과 같아야 합니다:</p>
<pre><code class="language-c">extern void hello_from_rust();

int main(void) {
    hello_from_rust();
    return 0;
}
</code></pre>
<p>파일 이름을 <code>call_rust.c</code> 로 짓고 크레이트 루트에 둡니다. 컴파일을 위해 다음을 실행하십시오:</p>
<pre><code class="language-sh">gcc call_rust.c -o call_rust -lrust_from_c -L./target/debug
</code></pre>
<p><code>-l</code> 과 <code>-L</code> 은 gcc에게 우리의 러스트 라이브러리를 찾을 위치를 알려줍니다.</p>
<p>마지막으로, <code>LD_LIBRARY_PATH</code> 를 지정하여 C에서 러스트 코드를 호출할 수 있습니다:</p>
<pre><code class="language-sh">$ LD_LIBRARY_PATH=./target/debug ./call_rust
Hello from Rust!
</code></pre>
<p>That’s it! For a more realistic example, check the <a href="https://github.com/eqrion/cbindgen"><code>cbindgen</code></a>.</p>
<h2 id="c-코드에서-러스트-함수로의-콜백"><a class="header" href="#c-코드에서-러스트-함수로의-콜백">C 코드에서 러스트 함수로의 콜백</a></h2>
<p>일부 외부 라이브러리는 현재 상태나 중간 데이터를 호출자에게 보고하기 위해 콜백 사용을 요구합니다. 러스트에서 정의된 함수를 외부 라이브러리에 전달하는 것이 가능합니다. 이를 위한 요구 사항은 콜백 함수가 C 코드에서 호출 가능하도록 올바른 호출 규약과 함께 <code>extern</code> 으로 표시되어야 한다는 것입니다.</p>
<p>그 후 콜백 함수는 등록 호출을 통해 C 라이브러리로 전달될 수 있으며, 그 후 거기에서 호출될 수 있습니다.</p>
<p>기본적인 예제는 다음과 같습니다:</p>
<p>러스트 코드:</p>
<pre class="playground"><code class="language-rust no_run edition2024">extern fn callback(a: i32) {
    println!("C에서 값 {0}과(와) 함께 호출되었습니다", a);
}

#[link(name = "extlib")]
unsafe extern {
   fn register_callback(cb: extern fn(i32)) -&gt; i32;
   fn trigger_callback();
}

fn main() {
    unsafe {
        register_callback(callback);
        trigger_callback(); // 콜백을 트리거합니다.
    }
}</code></pre>
<p>C 코드:</p>
<pre><code class="language-c">typedef void (*rust_callback)(int32_t);
rust_callback cb;

int32_t register_callback(rust_callback callback) {
    cb = callback;
    return 1;
}

void trigger_callback() {
  cb(7); // 러스트의 callback(7)을 호출할 것입니다.
}
</code></pre>
<p>이 예제에서 러스트의 <code>main()</code> 은 C의 <code>trigger_callback()</code> 을 호출하고, 이는 다시 러스트의 <code>callback()</code> 을 호출할 것입니다.</p>
<h2 id="러스트-객체를-대상으로-하는-콜백"><a class="header" href="#러스트-객체를-대상으로-하는-콜백">러스트 객체를 대상으로 하는 콜백</a></h2>
<p>앞의 예제는 C 코드에서 전역 함수를 호출하는 방법을 보여주었습니다. 하지만 종종 특정 러스트 객체를 대상으로 콜백을 호출하고 싶을 때가 있습니다. 이는 각각의 C 객체에 대한 래퍼를 나타내는 객체일 수 있습니다.</p>
<p>이는 객체에 대한 원시 포인터를 C 라이브러리에 전달함으로써 달성할 수 있습니다. 그러면 C 라이브러리는 알림에 러스트 객체에 대한 포인터를 포함할 수 있습니다. 이를 통해 콜백이 참조된 러스트 객체에 비안전하게 접근할 수 있게 됩니다.</p>
<p>러스트 코드:</p>
<pre class="playground"><code class="language-rust no_run edition2024">struct RustObject {
    a: i32,
    // 다른 멤버들...
}

unsafe extern "C" fn callback(target: *mut RustObject, a: i32) {
    println!("C에서 값 {0}과(와) 함께 호출되었습니다", a);
    unsafe {
        // 콜백으로부터 받은 값으로 RustObject의 값을 업데이트합니다:
        (*target).a = a;
    }
}

#[link(name = "extlib")]
unsafe extern {
   fn register_callback(target: *mut RustObject,
                        cb: unsafe extern fn(*mut RustObject, i32)) -&gt; i32;
   fn trigger_callback();
}

fn main() {
    // 콜백에서 참조될 객체를 생성합니다:
    let mut rust_object = Box::new(RustObject { a: 5 });

    unsafe {
        register_callback(&amp;mut *rust_object, callback);
        trigger_callback();
    }
}</code></pre>
<p>C 코드:</p>
<pre><code class="language-c">typedef void (*rust_callback)(void*, int32_t);
void* cb_target;
rust_callback cb;

int32_t register_callback(void* callback_target, rust_callback callback) {
    cb_target = callback_target;
    cb = callback;
    return 1;
}

void trigger_callback() {
  cb(cb_target, 7); // 러스트의 callback(&amp;rustObject, 7)을 호출할 것입니다.
}
</code></pre>
<h2 id="비동기-콜백"><a class="header" href="#비동기-콜백">비동기 콜백</a></h2>
<p>이전에 주어진 예제들에서 콜백은 외부 C 라이브러리에 대한 함수 호출의 직접적인 반응으로 호출됩니다. 콜백 실행을 위해 현재 스레드의 제어권이 러스트에서 C로, 다시 러스트로 전환되지만, 결국 콜백은 콜백을 트리거한 함수를 호출한 동일한 스레드에서 실행됩니다.</p>
<p>외부 라이브러리가 자체 스레드를 생성하고 거기서 콜백을 호출하면 상황은 더 복잡해집니다. 이런 경우 콜백 내부에서 러스트 데이터 구조에 접근하는 것은 특히 비안전하므로 적절한 동기화 메커니즘을 사용해야 합니다. 뮤텍스와 같은 고전적인 동기화 메커니즘 외에도, 러스트에서는 채널(<code>std::sync::mpsc</code>)을 사용하여 콜백을 호출한 C 스레드에서 러스트 스레드로 데이터를 전달하는 방법이 있습니다.</p>
<p>비동기 콜백이 러스트 주소 공간의 특정 객체를 대상으로 한다면, 해당 러스트 객체가 파괴된 후에는 C 라이브러리가 더 이상 콜백을 수행하지 않는 것이 절대적으로 필요합니다. 이는 객체의 소멸자에서 콜백 등록을 해제하고, 등록 해제 후에는 어떤 콜백도 수행되지 않음을 보장하도록 라이브러리를 설계함으로써 달성할 수 있습니다.비동기 콜백이 러스트 주소 공간의 특정 객체를 대상으로 한다면, 해당 러스트 객체가 파괴된 후에는 C 라이브러리가 더 이상 콜백을 수행하지 않는 것이 절대적으로 필요합니다. 이는 객체의 소멸자에서 콜백 등록을 해제하고, 등록 해제 후에는 어떤 콜백도 수행되지 않음을 보장하도록 라이브러리를 설계함으로써 달성할 수 있습니다.</p>
<h2 id="링킹-linking"><a class="header" href="#링킹-linking">링킹 (Linking)</a></h2>
<p><code>extern</code> 블록의 <code>link</code> 속성은 rustc에게 네이티브 라이브러리와 링크하는 방법을 지시하는 기본적인 빌딩 블록을 제공합니다. 오늘날 허용되는 link 속성 형식은 두 가지입니다:</p>
<ul>
<li><code>#[link(name = "foo")]</code></li>
<li><code>#[link(name = "foo", kind = "bar")]</code></li>
</ul>
<p>이 두 경우 모두 <code>foo</code> 는 링크하려는 네이티브 라이브러리의 이름이며, 두 번째 경우의 <code>bar</code> 는 컴파일러가 링크하려는 네이티브 라이브러리의 타입입니다. 현재 세 가지 종류의 네이티브 라이브러리가 알려져 있습니다:</p>
<ul>
<li>동적 - <code>#[link(name = "readline")]</code></li>
<li>정적 - <code>#[link(name = "my_build_dependency", kind = "static")]</code></li>
<li>프레임워크 - <code>#[link(name = "CoreFoundation", kind = "framework")]</code></li>
</ul>
<p>프레임워크는 macOS 타겟에서만 사용할 수 있음에 유의하십시오.</p>
<p>서로 다른 <code>kind</code> 값들은 네이티브 라이브러리가 링킹에 어떻게 참여하는지를 구분하기 위한 것입니다. 링킹 관점에서 러스트 컴파일러는 두 가지 종류의 아티팩트를 생성합니다: 부분적(rlib/staticlib) 아티팩트와 최종적(dylib/binary) 아티팩트입니다. 네이티브 동적 라이브러리와 프레임워크 의존성은 최종 아티팩트 경계까지 전파되지만, 정적 라이브러리 의존성은 전혀 전파되지 않습니다. 정적 라이브러리는 이어지는 아티팩트에 직접 통합되기 때문입니다.</p>
<p>이 모델이 어떻게 사용될 수 있는지 몇 가지 예시는 다음과 같습니다:</p>
<ul>
<li>
<p>네이티브 빌드 의존성. 때때로 러스트 코드를 작성할 때 C/C++ 글루(glue) 코드가 필요하지만, C/C++ 코드를 라이브러리 형식으로 배포하는 것이 부담스러울 수 있습니다. 이런 경우 코드는 <code>libfoo.a</code> 로 아카이브되고, 러스트 크레이트는 <code>#[link(name = "foo", kind = "static")]</code> 를 통해 의존성을 선언할 것입니다.</p>
<p>크레이트의 출력 형식에 관계없이 네이티브 정적 라이브러리가 출력물에 포함되므로, 네이티브 정적 라이브러리를 별도로 배포할 필요가 없습니다.</p>
</li>
<li>
<p>일반적인 동적 의존성. (<code>readline</code> 과 같은) 일반적인 시스템 라이브러리는 수많은 시스템에서 사용할 수 있으며, 종종 이러한 라이브러리의 정적 복사본을 찾을 수 없습니다. 러스트 크레이트에 이러한 의존성이 포함되면 (rlib과 같은) 부분적 타겟은 라이브러리에 링크되지 않지만, rlib이 최종 타겟(예: 바이너리)에 포함될 때 네이티브 라이브러리가 링크됩니다.</p>
</li>
</ul>
<p>macOS에서 프레임워크는 동적 라이브러리와 동일한 의미론으로 동작합니다.</p>
<h2 id="비안전-블록-unsafe-blocks"><a class="header" href="#비안전-블록-unsafe-blocks">비안전 블록 (Unsafe blocks)</a></h2>
<p>원시 포인터 역참조나 비안전(unsafe)으로 표시된 함수 호출과 같은 일부 연산은 비안전 블록 내부에서만 허용됩니다. 비안전 블록은 비안전성을 격리하며, 비안전성이 블록 밖으로 새어 나오지 않는다는 컴파일러에 대한 약속입니다.</p>
<p>반면 비안전 함수는 이를 세상에 알립니다. 비안전 함수는 다음과 같이 작성됩니다:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>unsafe fn kaboom(ptr: *const i32) -&gt; i32 { *ptr }
<span class="boring">}</span></code></pre>
<p>이 함수는 <code>unsafe</code> 블록이나 다른 <code>unsafe</code> 함수 내에서만 호출될 수 있습니다.</p>
<h2 id="외부-전역-변수-접근하기"><a class="header" href="#외부-전역-변수-접근하기">외부 전역 변수 접근하기</a></h2>
<p>외부 API는 전역 상태를 추적하는 등의 작업을 수행하는 전역 변수를 내보내는 경우가 많습니다. 이러한 변수에 접근하려면, <code>extern</code> 블록 내에서 <code>static</code> 키워드로 선언해야 합니다:</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore">#[link(name = "readline")]
unsafe extern {
    static rl_readline_version: libc::c_int;
}

fn main() {
    println!("readline 버전 {}이(가) 설치되어 있습니다.",
             unsafe { rl_readline_version as i32 });
}</code></pre>
<p>또는 외부 인터페이스가 제공하는 전역 상태를 변경해야 할 수도 있습니다. 이를 위해 <code>mut</code> 으로 정적 변수(statics)를 선언하여 변경할 수 있게 할 수 있습니다.</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore">use std::ffi::CString;
use std::ptr;

#[link(name = "readline")]
unsafe extern {
    static mut rl_prompt: *const libc::c_char;
}

fn main() {
    let prompt = CString::new("[my-awesome-shell] $").unwrap();
    unsafe {
        rl_prompt = prompt.as_ptr();

        println!("{:?}", rl_prompt);

        rl_prompt = ptr::null();
    }
}</code></pre>
<p><code>static mut</code> 과의 모든 상호작용(읽기 및 쓰기 모두)은 안전하지 않다는 점에 유의하십시오. 전역 가변 상태를 다루는 것은 상당한 주의를 요합니다.</p>
<h2 id="외부-호출-규약-foreign-calling-conventions"><a class="header" href="#외부-호출-규약-foreign-calling-conventions">외부 호출 규약 (Foreign calling conventions)</a></h2>
<p>대부분의 외부 코드는 C ABI를 노출하며, 러스트는 외부 함수를 호출할 때 기본적으로 플랫폼의 C 호출 규약을 사용합니다. 일부 외부 함수, 특히 윈도우 API는 다른 호출 규약을 사용합니다. 러스트는 어떤 규약을 사용할지 컴파일러에게 알려주는 방법을 제공합니다:</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore">#[cfg(all(target_os = "win32", target_arch = "x86"))]
#[link(name = "kernel32")]
#[allow(non_snake_case)]
unsafe extern "stdcall" {
    fn SetEnvironmentVariableA(n: *const u8, v: *const u8) -&gt; libc::c_int;
}
<span class="boring">fn main() { }</span></code></pre>
<p>이는 전체 <code>extern</code> 블록에 적용됩니다. 지원되는 ABI 제약 조건 목록은 다음과 같습니다:</p>
<ul>
<li><code>stdcall</code></li>
<li><code>aapcs</code></li>
<li><code>cdecl</code></li>
<li><code>fastcall</code></li>
<li><code>thiscall</code></li>
<li><code>vectorcall</code> 이는 현재 <code>abi_vectorcall</code> 게이트 뒤에 숨겨져 있으며 변경될 수 있습니다.</li>
<li><code>Rust</code></li>
<li><code>system</code></li>
<li><code>C</code></li>
<li><code>win64</code></li>
<li><code>sysv64</code></li>
</ul>
<p>Most of the ABIs in this list are self-explanatory, but the <code>system</code> ABI may seem a little odd. This constraint selects whatever the appropriate ABI is for interoperating with the target’s libraries. For example, on win32 with a x86 architecture, this means that the abi used would be <code>stdcall</code>. On x86_64, however, windows uses the <code>C</code> calling convention, so <code>C</code> would be used. This means that in our previous example, we could have used <code>extern "system" { ... }</code> to define a block for all windows systems, not only x86 ones.</p>
<h2 id="외부-코드와의-상호-운용성"><a class="header" href="#외부-코드와의-상호-운용성">외부 코드와의 상호 운용성</a></h2>
<p>러스트는 <code>#[repr(C)]</code> 속성이 적용된 경우에만 <code>struct</code> 의 레이아웃이 플랫폼의 C 표현과 호환됨을 보장합니다. <code>#[repr(C, packed)]</code> 는 패딩 없이 구조체 멤버를 배치하는 데 사용할 수 있습니다. <code>#[repr(C)]</code> 는 열거형(enum)에도 적용될 수 있습니다.</p>
<p>러스트의 소유된 박스(<code>Box&lt;T&gt;</code>)는 내부 객체를 가리키는 핸들로서 null이 될 수 없는 포인터를 사용합니다. 하지만 이들은 내부 할당자에 의해 관리되므로 수동으로 생성해서는 안 됩니다. 참조는 해당 타입으로 직접 향하는 null이 될 수 없는 포인터라고 안전하게 가정할 수 있습니다. 하지만 빌림 검사나 가변성 규칙을 어기는 것이 안전하다고 보장되지는 않으므로, 필요한 경우에는 원시 포인터(<code>*</code>)를 사용하는 것을 선호하십시오. 컴파일러가 원시 포인터에 대해서는 그만큼 많은 가정을 할 수 없기 때문입니다.</p>
<p>벡터와 문자열은 동일한 기본 메모리 레이아웃을 공유하며, <code>vec</code> 및 <code>str</code> 모듈에는 C API와 작업하기 위한 유틸리티들이 준비되어 있습니다. 하지만 문자열은 <code>\0</code> 으로 끝나지 않습니다. C와의 상호 운용성을 위해 NUL로 끝나는 문자열이 필요하다면 <code>std::ffi</code> 모듈의 <code>CString</code> 타입을 사용해야 합니다.</p>
<p><a href="https://crates.io/crates/libc">crates.io의 <code>libc</code> 크레이트</a> 는 <code>libc</code> 모듈에 C 표준 라이브러리를 위한 타입 별칭과 함수 정의를 포함하고 있으며, 러스트는 기본적으로 <code>libc</code> 및 <code>libm</code> 과 링크됩니다.</p>
<h2 id="가변-인자-함수-variadic-functions"><a class="header" href="#가변-인자-함수-variadic-functions">가변 인자 함수 (Variadic functions)</a></h2>
<p>C에서 함수는 ’가변 인자’를 가질 수 있습니다. 즉, 가변적인 개수의 인자를 받을 수 있음을 의미합니다. 러스트에서는 외부 함수 선언의 인자 목록 안에 <code>...</code> 를 지정함으로써 이를 달성할 수 있습니다:</p>
<pre><code class="language-no_run">unsafe extern {
    fn foo(x: i32, ...);
}

fn main() {
    unsafe {
        foo(10, 20, 30, 40, 50);
    }
}
</code></pre>
<p>일반적인 러스트 함수는 가변 인자를 가질 수 <em>없습니다</em>:</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 이 코드는 컴파일되지 않습니다

fn foo(x: i32, ...) {}
<span class="boring">}</span></code></pre>
<h2 id="널-포인터-최적화nullable-pointer-optimization"><a class="header" href="#널-포인터-최적화nullable-pointer-optimization">“널 포인터 최적화(nullable pointer optimization)”</a></h2>
<p>특정 러스트 타입들은 절대 <code>null</code> 이 될 수 없도록 정의되어 있습니다. 여기에는 참조(<code>&amp;T</code>, <code>&amp;mut T</code>), 박스(<code>Box&lt;T&gt;</code>), 그리고 함수 포인터(<code>extern "abi" fn()</code>)가 포함됩니다. C와 인터페이스할 때 <code>null</code> 일 수 있는 포인터가 자주 사용되는데, 러스트 타입과의 변환을 처리하기 위해 지저분한 <code>transmute</code> 나 안전하지 않은 코드가 필요해 보일 수 있습니다. 하지만 이러한 유효하지 않은 값을 생성하거나 다루려는 시도는 <strong>정의되지 않은 동작(undefined behavior)</strong> 이므로, 대신 다음과 같은 우회 방법을 사용해야 합니다.</p>
<p>특별한 경우로, <code>enum</code> 이 정확히 두 개의 변형(variant)을 가지고 있고, 그중 하나는 데이터를 포함하지 않으며 다른 하나는 위에서 나열한 널 불가 타입 중 하나의 필드를 포함한다면, 그 <code>enum</code> 은 “널 포인터 최적화” 대상이 됩니다. 이는 판별자(discriminant)를 위한 추가 공간이 필요하지 않음을 의미합니다. 대신, 비어 있는 변형은 널 불가 필드에 <code>null</code> 값을 넣음으로써 표현됩니다. 이를 “최적화“라고 부르지만, 다른 최적화와 달리 대상 타입에 대해 적용됨이 보장됩니다.</p>
<p>널 포인터 최적화를 활용하는 가장 흔한 타입은 <code>Option&lt;T&gt;</code> 이며, 여기서 <code>None</code> 은 <code>null</code> 에 해당합니다. 따라서 <code>Option&lt;extern "C" fn(c_int) -&gt; c_int&gt;</code> 는 C ABI를 사용하는 널 가능(nullable) 함수 포인터를 표현하는 올바른 방법입니다 (C 타입 <code>int (*)(int)</code> 에 해당).</p>
<p>여기 인위적인 예제가 하나 있습니다. 어떤 C 라이브러리에 특정 상황에서 호출되는 콜백을 등록하는 기능이 있다고 가정해 봅시다. 이 콜백은 함수 포인터와 정수를 전달받으며, 해당 정수를 인자로 하여 함수를 실행해야 합니다. 따라서 우리는 FFI 경계를 양방향으로 넘나드는 함수 포인터를 갖게 됩니다.</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore">use libc::c_int;

<span class="boring">#[cfg(hidden)]
</span>unsafe extern "C" {
    /// 콜백을 등록합니다.
    fn register(cb: Option&lt;extern "C" fn(Option&lt;extern "C" fn(c_int) -&gt; c_int&gt;, c_int) -&gt; c_int&gt;);
}
<span class="boring">unsafe fn register(_: Option&lt;extern "C" fn(Option&lt;extern "C" fn(c_int) -&gt; c_int&gt;,
</span><span class="boring">                                           c_int) -&gt; c_int&gt;)
</span><span class="boring">{}
</span>
/// 이 꽤 쓸모없는 함수는 C로부터 함수 포인터와 정수를 전달받아,
/// 해당 정수를 인자로 하여 함수를 호출한 결과를 반환합니다.
/// 함수가 제공되지 않은 경우, 기본적으로 정수를 제곱합니다.
extern "C" fn apply(process: Option&lt;extern "C" fn(c_int) -&gt; c_int&gt;, int: c_int) -&gt; c_int {
    match process {
        Some(f) =&gt; f(int),
        None    =&gt; int * int
    }
}

fn main() {
    unsafe {
        register(Some(apply));
    }
}</code></pre>
<p>그리고 C 측 코드는 다음과 같습니다:</p>
<pre><code class="language-c">void register(int (*f)(int (*)(int), int)) {
    ...
}
</code></pre>
<p><code>transmute</code> 가 필요 없습니다!</p>
<h2 id="ffi와-언와인딩-ffi-and-unwinding"><a class="header" href="#ffi와-언와인딩-ffi-and-unwinding">FFI와 언와인딩 (FFI and unwinding)</a></h2>
<p>FFI와 작업할 때는 언와인딩(unwinding)에 유의하는 것이 중요합니다. 대부분의 ABI 문자열은 <code>-unwind</code> 접미사가 있는 것과 없는 것의 두 가지 변형으로 제공됩니다. <code>Rust</code> ABI는 항상 언와인딩을 허용하므로, <code>Rust-unwind</code> ABI는 따로 없습니다.</p>
<p>만약 러스트의 <code>panic</code> 이나 외부(예: C++) 예외가 FFI 경계를 넘나들 것으로 예상된다면, 해당 경계는 적절한 <code>-unwind</code> ABI 문자열을 사용해야 합니다. 반대로, 언와인딩이 ABI 경계를 넘지 않을 것으로 예상된다면, <code>-unwind</code> 가 없는 ABI 문자열 중 하나를 사용하십시오.</p>
<blockquote>
<p>참고: <code>panic=abort</code> 로 컴파일하면, <code>panic</code> 을 일으키는 함수에 지정된 ABI와 관계없이 <code>panic!</code> 은 즉시 프로세스를 중단시킵니다.</p>
</blockquote>
<p>만약 언와인딩 연산이 언와인딩이 허용되지 않는 ABI 경계를 만나게 되면, 그 동작은 언와인딩의 원천(러스트 <code>panic</code> 또는 외부 예외)에 따라 달라집니다:</p>
<ul>
<li><code>panic</code> 은 프로세스를 안전하게 중단(abort)시킵니다.</li>
<li>러스트로 들어오는 외부 예외는 정의되지 않은 동작을 유발합니다.</li>
</ul>
<p><code>catch_unwind</code> 와 외부 예외 사이의 상호작용은 <strong>정의되지 않았으며</strong>, <code>panic</code> 과 외부 예외 포착 메커니즘(특히 C++의 <code>try</code>/<code>catch</code>) 사이의 상호작용도 마찬가지입니다.</p>
<h3 id="c-unwind-를-사용한-러스트-panic"><a class="header" href="#c-unwind-를-사용한-러스트-panic"><code>"C-unwind"</code> 를 사용한 러스트 <code>panic</code></a></h3>
<!-- ignore: using unstable feature -->
<pre><code class="language-rust ignore">#[unsafe(no_mangle)]
unsafe extern "C-unwind" fn example() {
    panic!("어라");
}</code></pre>
<p>이 함수는 (<code>panic=unwind</code> 로 컴파일되었을 때) C++ 스택 프레임을 언와인딩하는 것이 허용됩니다.</p>
<pre><code class="language-text">[Rust function with `catch_unwind`, which stops the unwinding]
      |
     ...
      |
[C++ frames]
      |                           ^
      | (calls)                   | (unwinding
      v                           |  goes this
[Rust function `example`]         |  way)
      |                           |
      +--- rust function panics --+
</code></pre>
<p>C++ 프레임에 객체가 있다면, 그들의 소멸자가 호출될 것입니다.</p>
<h3 id="c-unwind-를-사용한-c-throw"><a class="header" href="#c-unwind-를-사용한-c-throw"><code>"C-unwind"</code> 를 사용한 C++ <code>throw</code></a></h3>
<!-- ignore: using unstable feature -->
<pre><code class="language-rust ignore">#[link(...)]
unsafe extern "C-unwind" {
    // 예외를 던질 수 있는 C++ 함수
    fn may_throw();
}

#[unsafe(no_mangle)]
unsafe extern "C-unwind" fn rust_passthrough() {
    let b = Box::new(5);
    unsafe { may_throw(); }
    println!("{:?}", &amp;b);
}</code></pre>
<p><code>try</code> 블록이 있는 C++ 함수는 <code>rust_passthrough</code> 를 호출하고 <code>may_throw</code> 에 의해 던져진 예외를 <code>catch</code> 할 수 있습니다.</p>
<pre><code class="language-text">[C++ function with `try` block that invokes `rust_passthrough`]
      |
     ...
      |
[Rust function `rust_passthrough`]
      |                            ^
      | (calls)                    | (unwinding
      v                            |  goes this
[C++ function `may_throw`]         |  way)
      |                            |
      +--- C++ function throws ----+
</code></pre>
<p>만약 <code>may_throw</code> 가 예외를 던진다면 <code>b</code> 는 드롭될 것입니다. 그렇지 않다면 <code>5</code> 가 출력될 것입니다.</p>
<h3 id="panic-은-abi-경계에서-멈출-수-있습니다"><a class="header" href="#panic-은-abi-경계에서-멈출-수-있습니다"><code>panic</code> 은 ABI 경계에서 멈출 수 있습니다</a></h3>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[unsafe(no_mangle)]
extern "C" fn assert_nonzero(input: u32) {
    assert!(input != 0)
}
<span class="boring">}</span></code></pre>
<p>만약 <code>assert_nonzero</code> 가 인자 <code>0</code> 과 함께 호출되면, 런타임은 <code>panic=abort</code> 로 컴파일되었는지 여부와 관계없이 프로세스를 (안전하게) 중단시킬 것임을 보장합니다.</p>
<h3 id="panic-을-선제적으로-포착하기"><a class="header" href="#panic-을-선제적으로-포착하기"><code>panic</code> 을 선제적으로 포착하기</a></h3>
<p>패닉이 발생할 수 있는 러스트 코드를 작성 중이고, 패닉 시 프로세스가 중단되는 것을 원치 않는다면 <a href="../std/panic/fn.catch_unwind.html"><code>catch_unwind</code></a> 를 사용해야 합니다.</p>
<pre class="playground"><code class="language-rust edition2024">use std::panic::catch_unwind;

#[unsafe(no_mangle)]
pub extern "C" fn oh_no() -&gt; i32 {
    let result = catch_unwind(|| {
        panic!("이크!");
    });
    match result {
        Ok(_) =&gt; 0,
        Err(_) =&gt; 1,
    }
}

fn main() {}</code></pre>
<p><a href="../std/panic/fn.catch_unwind.html"><code>catch_unwind</code></a> 은 언와인딩 패닉만을 포착하며, 프로세스를 중단시키는 패닉은 포착하지 못한다는 점에 유의하십시오. 자세한 내용은 <a href="../std/panic/fn.catch_unwind.html"><code>catch_unwind</code></a> 문서를 참조하십시오.</p>
<h2 id="불투명한opaque-구조체-표현하기"><a class="header" href="#불투명한opaque-구조체-표현하기">불투명한(opaque) 구조체 표현하기</a></h2>
<p>때때로 C 라이브러리는 어떤 것에 대한 포인터를 제공하고 싶어 하지만, 그 내부 세부 사항을 알리고 싶어 하지 않습니다. 안정적이고 간단한 방법은 <code>void *</code> 인자를 사용하는 것입니다.</p>
<pre><code class="language-c">void foo(void *arg);
void bar(void *arg);
</code></pre>
<p>우리는 러스트에서 <code>c_void</code> 타입을 사용하여 이를 표현할 수 있습니다:</p>
<!-- ignore: requires libc crate -->
<pre><code class="language-rust ignore">unsafe extern "C" {
    pub fn foo(arg: *mut libc::c_void);
    pub fn bar(arg: *mut libc::c_void);
}
<span class="boring">fn main() {}</span></code></pre>
<p>This is a perfectly valid way of handling the situation. However, we can do a bit better. To solve this, some C libraries will instead create a <code>struct</code>, where the details and memory layout of the struct are private. This gives some amount of type safety. These structures are called ‘opaque’. Here’s an example, in C:</p>
<pre><code class="language-c">struct Foo; /* Foo는 구조체이지만, 그 내용은 공개 인터페이스의 일부가 아닙니다 */
struct Bar;
void foo(struct Foo *arg);
void bar(struct Bar *arg);
</code></pre>
<p>러스트에서 이를 구현하기 위해, 우리만의 불투명 타입을 만들어 봅시다:</p>
<pre class="playground"><code class="language-rust edition2024">#[repr(C)]
pub struct Foo {
    _data: (),
    _marker:
        core::marker::PhantomData&lt;(*mut u8, core::marker::PhantomPinned)&gt;,
}
#[repr(C)]
pub struct Bar {
    _data: (),
    _marker:
        core::marker::PhantomData&lt;(*mut u8, core::marker::PhantomPinned)&gt;,
}

unsafe extern "C" {
    pub fn foo(arg: *mut Foo);
    pub fn bar(arg: *mut Bar);
}
<span class="boring">fn main() {}</span></code></pre>
<p>By including at least one private field and no constructor, we create an opaque type that we can’t instantiate outside of this module. (A struct with no field could be instantiated by anyone.) We also want to use this type in FFI, so we have to add <code>#[repr(C)]</code>. The marker ensures the compiler does not mark the struct as <code>Send</code>, <code>Sync</code>, and <code>Unpin</code>. (<code>*mut u8</code> is not <code>Send</code> or <code>Sync</code>, <code>PhantomPinned</code> is not <code>Unpin</code>)</p>
<p>하지만 우리의 <code>Foo</code> 와 <code>Bar</code> 타입은 서로 다르기 때문에, 둘 사이에 타입 안전성이 확보됩니다. 따라서 실수로 <code>Foo</code> 에 대한 포인터를 <code>bar()</code> 에 전달하는 일을 방지할 수 있습니다.</p>
<p>비어 있는 열거형(enum)을 FFI 타입으로 사용하는 것은 정말 좋지 않은 생각입니다. 컴파일러는 비어 있는 열거형이 거주 불가능(uninhabited)하다는 것에 의존하므로, <code>&amp;Empty</code> 타입의 값을 다루는 것은 매우 위험하며 정의되지 않은 동작을 유발하여 비정상적인 프로그램 동작으로 이어질 수 있습니다.</p>
<blockquote>
<p><strong>참고:</strong> 가장 간단한 방법은 “외부 타입(extern types)“을 사용하는 것입니다. 하지만 현재(2021년 6월 기준) 불안정한 상태이며 해결되지 않은 질문들이 남아 있습니다. 자세한 내용은 <a href="https://rust-lang.github.io/rfcs/1861-extern-types.html">RFC 페이지</a>와 <a href="https://github.com/rust-lang/rust/issues/43467">트래킹 이슈</a>를 참조하십시오.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="arc-mutex/arc-final.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="beneath-std.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="arc-mutex/arc-final.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="beneath-std.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/language-picker-0917ae23.js"></script>



    </div>
    </body>
</html>
